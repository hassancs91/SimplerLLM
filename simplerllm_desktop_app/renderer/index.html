<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' http://localhost:*">
    <title>SimplerLLM Playground</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Bangers&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/memphis.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/brainstorm.css">

    <style>
        /* Layout styles */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* Decorative shapes in background */
        .content-area::before {
            content: '';
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--memphis-pink);
            border: 3px solid var(--memphis-black);
            border-radius: 50%;
            opacity: 0.3;
            z-index: 0;
        }

        .content-area::after {
            content: '';
            position: absolute;
            bottom: 150px;
            left: 30px;
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-bottom: 40px solid var(--memphis-yellow);
            opacity: 0.3;
            z-index: 0;
        }

        /* Header section */
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-secondary);
            border-bottom: var(--border-width) solid var(--border-color);
            z-index: 1;
        }

        .chat-header__left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .chat-header__title {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
        }

        .chat-header__right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* Provider selection in sidebar */
        .provider-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        /* Model selector */
        .model-select-container {
            padding: var(--spacing-md);
            background: var(--bg-primary);
            border: var(--border-width) solid var(--border-color);
            border-radius: var(--border-radius-md);
            margin-top: var(--spacing-md);
        }

        /* Settings section */
        .settings-section {
            margin-top: var(--spacing-lg);
        }

        .settings-section__title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-bold);
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-sm);
        }

        .slider-container {
            margin-bottom: var(--spacing-md);
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-xs);
        }

        /* Empty state */
        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: var(--spacing-2xl);
            color: var(--text-secondary);
        }

        .empty-state__icon {
            width: 80px;
            height: 80px;
            background: var(--memphis-yellow);
            border: var(--border-width) solid var(--border-color);
            border-radius: var(--border-radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }

        .empty-state__title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        /* View toggle */
        .view-tabs {
            display: flex;
            background: var(--memphis-gray-light);
            border: var(--border-width) solid var(--border-color);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .view-tab {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            border: none;
            background: transparent;
            cursor: pointer;
        }

        .view-tab--active {
            background: var(--memphis-yellow);
        }

        /* Chat view layout */
        .chat-view {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Hidden class */
        .hidden { display: none !important; }

        /* Settings panel */
        .settings-panel {
            position: fixed;
            top: var(--titlebar-height);
            right: 0;
            bottom: 0;
            width: 400px;
            background: var(--bg-primary);
            border-left: var(--border-width) solid var(--border-color);
            box-shadow: -8px 0 20px rgba(0,0,0,0.1);
            z-index: var(--z-modal);
            transform: translateX(100%);
            transition: transform var(--transition-slow);
            display: flex;
            flex-direction: column;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-panel__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            background: var(--memphis-purple);
            color: var(--memphis-white);
            border-bottom: var(--border-width) solid var(--border-color);
        }

        .settings-panel__content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-lg);
        }

        .api-key-input {
            margin-bottom: var(--spacing-lg);
        }

        .api-key-input__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }

        .status-dot--configured { background: var(--memphis-teal); }
        .status-dot--unconfigured { background: var(--memphis-gray); }
    </style>
</head>
<body>
    <div class="app">
        <!-- Title Bar -->
        <div class="titlebar">
            <span class="titlebar__title">SimplerLLM Playground</span>
            <div class="titlebar__actions">
                <button class="titlebar__action-btn" id="btn-settings" title="API Keys">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>
            <div class="titlebar__controls">
                <button class="titlebar__btn titlebar__btn--minimize" id="btn-minimize" title="Minimize"></button>
                <button class="titlebar__btn titlebar__btn--maximize" id="btn-maximize" title="Maximize"></button>
                <button class="titlebar__btn titlebar__btn--close" id="btn-close" title="Close"></button>
            </div>
        </div>

        <!-- Tools View (default landing page) -->
        <div class="tools-view" id="tools-view">
            <h1 class="tools-view__title">Tools</h1>
            <div class="tools-grid" id="tools-grid">
                <!-- Tool cards will be rendered here by JS -->
            </div>
        </div>

        <!-- Chat View -->
        <div class="chat-view hidden" id="chat-view">
            <!-- Main Container -->
            <div class="main-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar__content" style="padding: var(--spacing-lg);">
                    <!-- Provider Dropdown -->
                    <div class="input-group" style="margin-bottom: var(--spacing-md);">
                        <label class="input-label" for="provider-select">Provider</label>
                        <select class="select" id="provider-select">
                            <option value="">Select a provider...</option>
                        </select>
                    </div>

                    <!-- Model Input -->
                    <div class="input-group" style="margin-bottom: var(--spacing-lg);">
                        <label class="input-label" for="model-select">Model</label>
                        <input type="text" class="input" id="model-select" placeholder="Enter model name (e.g., gpt-4o)">
                    </div>

                    <!-- Parameters Section -->
                    <div class="settings-section">
                        <div class="settings-section__title">Parameters</div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Temperature</span>
                                <span id="temperature-value">0.7</span>
                            </div>
                            <input type="range" class="slider" id="temperature-slider" min="0" max="2" step="0.1" value="0.7">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Max Tokens</span>
                                <span id="max-tokens-value">1000</span>
                            </div>
                            <input type="range" class="slider" id="max-tokens-slider" min="100" max="4000" step="100" value="1000">
                        </div>

                        <div class="input-group">
                            <label class="input-label" for="system-prompt">System Prompt</label>
                            <textarea class="input textarea" id="system-prompt" rows="4" placeholder="You are a helpful assistant...">You are a helpful assistant.</textarea>
                        </div>
                    </div>
                </div>

            </aside>

            <!-- Main Content -->
            <main class="content-area">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-header__left">
                        <button class="btn btn--ghost btn--sm" id="btn-back-to-tools">‚Üê Back</button>
                        <h2 class="chat-header__title">Chat</h2>
                        <span class="badge badge--success" id="status-badge">Ready</span>
                    </div>
                    <div class="chat-header__right">
                        <button class="btn btn--ghost btn--sm" id="btn-clear">Clear Chat</button>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="chat-container" id="chat-container">
                    <!-- Empty state -->
                    <div class="empty-state" id="empty-state">
                        <div class="empty-state__icon">
                            <span>üí¨</span>
                        </div>
                        <h3 class="empty-state__title">Start a conversation</h3>
                        <p>Select a provider and model, then type a message below.</p>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-container">
                    <textarea
                        class="input chat-input"
                        id="chat-input"
                        placeholder="Type your message... (Press Enter to send, Shift+Enter for new line)"
                        rows="2"
                    ></textarea>
                    <button class="btn btn--primary" id="btn-send">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                        Send
                    </button>
                </div>
            </main>
        </div>
        </div> <!-- End Chat View -->

        <!-- Brainstorm View -->
        <div class="brainstorm-view hidden" id="brainstorm-view">
            <div class="main-container">
                <!-- Left Pane: Tree Visualization -->
                <div class="brainstorm-tree-pane">
                    <div class="brainstorm-tree-header">
                        <button class="btn btn--ghost btn--sm" id="btn-back-from-brainstorm">‚Üê Back</button>
                        <h2 class="brainstorm-tree-title">Idea Tree</h2>
                        <div class="brainstorm-tree-controls">
                            <button class="btn btn--ghost btn--sm" id="btn-zoom-in" title="Zoom In">+</button>
                            <button class="btn btn--ghost btn--sm" id="btn-zoom-out" title="Zoom Out">-</button>
                            <button class="btn btn--ghost btn--sm" id="btn-zoom-reset" title="Reset View">Reset</button>
                        </div>
                    </div>
                    <div class="brainstorm-tree-container" id="brainstorm-tree-container">
                        <svg id="brainstorm-svg" width="100%" height="100%"></svg>
                    </div>
                    <div class="brainstorm-tree-legend">
                        <span class="legend-item"><span class="legend-dot legend-dot--high"></span> High (8-10)</span>
                        <span class="legend-item"><span class="legend-dot legend-dot--mid"></span> Medium (5-7)</span>
                        <span class="legend-item"><span class="legend-dot legend-dot--low"></span> Low (1-4)</span>
                    </div>
                </div>

                <!-- Right Pane: Controls & Details -->
                <div class="brainstorm-control-pane">
                    <!-- Input Section -->
                    <div class="brainstorm-input-section">
                        <h3 class="section-title">Brainstorm Prompt</h3>
                        <textarea
                            class="input textarea brainstorm-prompt"
                            id="brainstorm-prompt"
                            placeholder="Enter your brainstorming topic... (e.g., 'Ways to improve customer engagement')"
                            rows="4"
                        ></textarea>
                    </div>

                    <!-- Provider/Model Section -->
                    <div class="brainstorm-params-section">
                        <h3 class="section-title">LLM Configuration</h3>

                        <div class="input-group">
                            <label class="input-label">Provider</label>
                            <select class="select" id="brainstorm-provider">
                                <!-- Populated by JS -->
                            </select>
                        </div>

                        <div class="input-group">
                            <label class="input-label">Model</label>
                            <input type="text" class="input" id="brainstorm-model" placeholder="e.g., gpt-4o">
                        </div>
                    </div>

                    <!-- Brainstorm Parameters -->
                    <div class="brainstorm-params-section">
                        <h3 class="section-title">Parameters</h3>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Max Depth</span>
                                <span id="max-depth-value">2</span>
                            </div>
                            <input type="range" class="slider" id="max-depth-slider" min="1" max="5" step="1" value="2">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Ideas per Level</span>
                                <span id="ideas-per-level-value">5</span>
                            </div>
                            <input type="range" class="slider" id="ideas-per-level-slider" min="3" max="10" step="1" value="5">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Top N to Expand</span>
                                <span id="top-n-value">3</span>
                            </div>
                            <input type="range" class="slider" id="top-n-slider" min="1" max="5" step="1" value="3">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Min Quality Threshold</span>
                                <span id="min-quality-value">5</span>
                            </div>
                            <input type="range" class="slider" id="min-quality-slider" min="1" max="10" step="0.5" value="5">
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="brainstorm-actions">
                        <button class="btn btn--primary" id="btn-start-brainstorm">
                            <span id="brainstorm-btn-text">Start Brainstorm</span>
                        </button>
                        <button class="btn btn--ghost" id="btn-cancel-brainstorm" style="display: none;">Cancel</button>
                        <button class="btn btn--ghost" id="btn-clear-brainstorm">Clear</button>
                    </div>

                    <!-- Progress/Status -->
                    <div class="brainstorm-status hidden" id="brainstorm-status">
                        <div class="status-header">
                            <span class="badge badge--warning" id="brainstorm-status-badge">Running...</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar__fill" id="brainstorm-progress"></div>
                        </div>
                        <div class="status-info">
                            <span>Depth: <strong id="current-depth">0</strong></span>
                            <span>Ideas: <strong id="ideas-count">0</strong></span>
                            <span>Time: <strong id="elapsed-time">0s</strong></span>
                        </div>
                    </div>

                    <!-- Stats Section (shown after completion) -->
                    <div class="brainstorm-stats hidden" id="brainstorm-stats">
                        <h3 class="section-title">Results</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="stat-total-ideas">0</div>
                                <div class="stat-label">Total Ideas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-best-score">0</div>
                                <div class="stat-label">Best Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-avg-score">0</div>
                                <div class="stat-label">Avg Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="stat-exec-time">0s</div>
                                <div class="stat-label">Time</div>
                            </div>
                        </div>
                        <button class="btn btn--secondary" id="btn-export-results">Export Results</button>
                    </div>

                    <!-- Selected Idea Detail -->
                    <div class="brainstorm-idea-detail hidden" id="brainstorm-idea-detail">
                        <h3 class="section-title">Selected Idea</h3>
                        <div class="idea-detail-card">
                            <div class="idea-score-badge" id="detail-score">8.5</div>
                            <p class="idea-text" id="detail-text"></p>
                            <p class="idea-reasoning" id="detail-reasoning"></p>
                            <div class="idea-meta">
                                <span>Depth: <strong id="detail-depth">0</strong></span>
                                <span>ID: <code id="detail-id"></code></span>
                            </div>
                        </div>
                    </div>

                    <!-- Code Example Section -->
                    <div class="brainstorm-code-section" id="brainstorm-code-section">
                        <div class="code-section-header" id="toggle-code-section">
                            <h3 class="section-title">Code Example</h3>
                            <span class="toggle-icon" id="code-toggle-icon">‚ñº</span>
                        </div>
                        <div class="code-section-content" id="code-section-content">
                            <pre class="code-block"><code id="code-snippet"></code></pre>
                            <button class="btn btn--ghost btn--sm" id="btn-copy-code">Copy Code</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!-- End Brainstorm View -->

        <!-- Settings Panel (Slide-in) -->
        <div class="settings-panel" id="settings-panel">
            <div class="settings-panel__header">
                <h3>API Keys</h3>
                <button class="btn btn--icon btn--ghost" id="btn-close-settings" style="background: transparent; border-color: white;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="settings-panel__content" id="api-keys-container">
                <!-- API key inputs will be dynamically inserted here -->
            </div>
        </div>

        <!-- Toast container -->
        <div id="toast-container"></div>
    </div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/tree-visualizer.js"></script>
    <script src="js/brainstorm.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
